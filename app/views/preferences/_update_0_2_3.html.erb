<h3>Table update: page_files</h3>
<% contents = Content.all %>
<% contents.each do |content| %>
<% if content.page_files.where(category: 'cover').size == 0 %>
<% page_file = PageFile.create(content_id: content.id, display_order: 0, category: 'cover') %>
<% message = 'Error: Failed to create cover page for content.id = ' + content.id.to_s %>
<%= render(partial: 'layouts/system_message', locals: {message: message, message_category: 'error'}) unless page_file.save %>
<% end %>

<% if content.page_files.where(category: 'assignment').size == 0 %>
<% display_order = content.page_files.pluck(:display_order).max + 1 %>
<% page_file = PageFile.create(content_id: content.id, display_order: display_order, category: 'assignment') %>
<% message = 'Error: Failed to create assignment page for content.id = ' + content.id.to_s %>
<%= render(partial: 'layouts/system_message', locals: {message: message, message_category: 'error'}) unless page_file.save %>
<% end %>
<% end %>

<h3>Table update: stickies</h3>
<% stickies = Sticky.all %>
<% stickies.each do |sticky| %>
<% if (sticky.target_type == 'PageFile') && ((sticky.target_id == 0) || (sticky.target_id == -1)) %>
<% category = (sticky.target_id == 0) ? 'cover' : 'assignment' %>
<% target_id = PageFile.find_by(content_id: sticky.content_id, category: category).id %>
<% unless sticky.update_attributes(target_id: target_id) %>
<%= render partial: 'layouts/system_message', locals: {message: 'Error: sticky target_idupdate, ' + sticky.id.to_s, message_category: 'error'} %>
<% end %>
<% end %>
<% end %>
